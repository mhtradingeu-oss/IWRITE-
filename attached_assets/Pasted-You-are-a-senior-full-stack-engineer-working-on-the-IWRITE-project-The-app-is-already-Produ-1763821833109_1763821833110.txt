You are a senior full-stack engineer working on the **IWRITE** project.

The app is already:
- Production-hardened (config validation, security headers, request limits, CORS).
- Fully documented via DEPLOYMENT.md.
- Functionally complete (AI Writer, Songwriter, Templates, Style Profiles, Topics, QA, Export, etc.).
- Currently has **NO authentication** and assumes a single shared workspace.

üéØ GOAL

Before we deploy to cPanel / VPS, I want you to:

1. Add a **simple, secure login system** (authentication).
2. Add a **basic subscription plan model** with:
   - One FREE plan
   - One paid plan at 14.99 monthly
   - A yearly paid option
3. Make sure:
   - You do NOT break or duplicate existing features, routes, or DB schema.
   - Changes are additive and backwards-compatible.
   - The app remains stable and production-ready.

Do NOT redesign everything. Extend the current architecture in a minimal, safe way.

---

üß© PART 1 ‚Äî AUTHENTICATION (LOGIN SYSTEM)

Implement a **basic but secure auth** layer suitable for v1:

1) Data Model
- Add a `users` table/model with at least:
  - `id` (UUID or serial)
  - `email` (unique)
  - `password_hash` (bcrypt-hashed password)
  - `plan` or `subscription_tier` (string/enum, see Part 2)
  - `created_at`, `updated_at`
- Do NOT modify existing tables in a breaking way. Only add new tables/relations or optional columns.

2) Password Handling
- Use a proven password hashing algorithm (e.g. **bcrypt**).
- Never store plain-text passwords.
- When a user registers:
  - Validate email format.
  - Validate minimum password strength.
  - Hash password before insert.

3) Session / Auth Mechanism
- Implement login via:
  - Email + Password.
- Use either:
  - Secure HTTP-only cookie with a signed session token, OR
  - JWT stored in an HTTP-only cookie.
- The important points:
  - Cookie must be `httpOnly`, `secure` in production, and have a sensible expiration.
  - On each authenticated request, decode/verify the token and load the current user.

4) Routes / UI
- Add routes for:
  - `POST /auth/register` (optional for now) or a script to create the first admin.
  - `POST /auth/login`
  - `POST /auth/logout`
- Add a simple **Login page** in the frontend:
  - Email input
  - Password input
  - Login button
  - Basic error handling

5) Protecting the App
- Add middleware on the server that:
  - Checks for a valid session/user for all **main app** routes (dashboard, AI Writer, Songwriter, Templates, etc.).
- For v1, it is OK if there is **only one user** or a small number of users (no full multi-tenant isolation necessary).
- The key requirement:
  - Anyone must log in before they can access the IWRITE workspace UI.
- Update DEPLOYMENT.md:
  - Explain how to create the initial user account (via CLI script or temporary ‚Äúregister‚Äù endpoint).
  - Explain how to configure any env vars related to auth (e.g. JWT secret).

---

üß© PART 2 ‚Äî SUBSCRIPTION PLANS (LOGIC ONLY FOR NOW)

Implement a simple subscription model for v1. We are **not** asking for full Stripe integration yet, but the model must be ready for it.

1) Plan Model
- Define three logical plans:

  - `FREE`
    - For trial and basic use.
  - `PRO_MONTHLY`
    - Price: 14.99 (you can store the numeric price as metadata).
  - `PRO_YEARLY`
    - Price: e.g. 149.99 (effectively ~2 months free).

- Represent them as:
  - An enum/string in code (e.g. `'FREE' | 'PRO_MONTHLY' | 'PRO_YEARLY'`).
  - A `plan` or `subscription_tier` field on the `users` table (or a separate `subscriptions` table if you prefer a more normalized approach).

2) Subscription Fields
- At minimum, store on the user (or subscription record):
  - `plan` (FREE, PRO_MONTHLY, PRO_YEARLY)
  - `plan_started_at`
  - `plan_expires_at` (for PRO_MONTHLY/YEARLY; can be null for FREE)
- Default new users to `FREE` plan.

3) UI & UX
- Add a simple **‚ÄúPlans / Upgrade‚Äù** section/page:
  - Shows the three plans:
    - FREE
    - Pro Monthly ‚Äì 14.99/month
    - Pro Yearly ‚Äì 14.99 * 12 with yearly discount (e.g. 149.99/year).
  - For now, you can:
    - Either just simulate plan changes (for internal testing),
    - Or prepare integration points for Stripe (e.g. ‚ÄúUpgrade‚Äù button that calls a `/billing/checkout` endpoint with a TODO inside).
- Add small plan indicators in the UI:
  - e.g. in the top-right of the app show ‚ÄúPlan: FREE‚Äù or ‚ÄúPlan: PRO (Yearly)‚Äù.

4) Feature Gating (Lightweight)
- Implement **soft gating** for v1 (no need for very strict enforcement yet, but some visible behavior):
  - Example:
    - FREE plan: limit to X AI generations per day OR show ‚ÄúUpgrade to PRO‚Äù banner after some usage.
    - PRO plans: full unlimited access (or higher limits).
- IMPORTANT:
  - Do NOT break existing flows if plan logic is misconfigured.
  - If in doubt, default to allowing access but showing an ‚ÄúUpgrade recommended‚Äù banner.

5) Future-proof for Stripe (without implementing it now)
- In the code, clearly mark where payment integration would go, e.g.:
  - `/billing/checkout` endpoint (returning a TODO response for now).
  - Document in comments and in DEPLOYMENT.md that:
    - Payment integration is planned via Stripe (or similar).
    - Currently, plan changes can be done manually (e.g. via admin tools or DB).

---

üß© PART 3 ‚Äî SAFETY: DO NOT BREAK EXISTING FEATURES

This is critical:

1) Database
- Only add new tables/columns/migrations that are backwards-compatible.
- Do NOT remove or rename existing columns used by the current app.
- Run migrations safely and verify they succeed.

2) API & Frontend
- Keep existing routes and pages intact:
  - AI Writer
  - Songwriter
  - Templates
  - Style Profiles
  - Topics
  - QA
  - Export
- Only wrap them with auth checks (and plan checks if needed) without changing their core behavior.
- Test that all core flows still work after the auth layer is added, once a user is logged in.

3) No Duplication
- Reuse existing layout/components for the login page and ‚ÄúPlans‚Äù page where possible.
- Do NOT duplicate entire pages or create parallel versions of the app.
- Keep code clean and consistent with the existing patterns.

---

üß© PART 4 ‚Äî FINAL VERIFICATION & COMMIT

Before finishing:

1) Run:
   - `npm run build`
   - `NODE_ENV=production npm run start`
   - Call `/healthz` and confirm status is ok.
2) Manually test in a browser:
   - Login flow:
     - Login with a test user.
   - Access to:
     - Dashboard, AI Writer, Songwriter, Templates, Style Profiles, Topics, QA, Export.
   - Plan indication (e.g. FREE vs PRO).
3) Update:
   - `DEPLOYMENT.md`:
     - Add section about Auth & Plans.
     - How to create the first user.
     - How to change plan manually for now.
4) Finally:
   - Commit all changes with a clear message (e.g. `feat: add auth and basic subscription plans`).
   - Ensure the repo is clean (no untracked/dirty files).

Your goal:  
Add a **minimal, secure login + plan model** to IWRITE that:
- Protects the app behind authentication.
- Introduces FREE and PRO (monthly/yearly) plans.
- Does NOT damage or duplicate existing features.
- Keeps the project fully production-ready and well-documented.
