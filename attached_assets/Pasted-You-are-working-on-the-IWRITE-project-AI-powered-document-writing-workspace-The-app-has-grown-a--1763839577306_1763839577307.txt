You are working on the IWRITE project (AI-powered document writing workspace).

The app has grown a lot: auth, plans, admin panel, billing, legal pages, footer, templates, etc.  
Now there are some routing/UI inconsistencies (e.g., 404 on dashboard or other pages) and we want a **full, careful audit and repair pass**.

‚ö†Ô∏è CRITICAL REQUIREMENT
Your job is to **stabilize and polish** the existing app ‚Äî NOT to redesign or rewrite it.

You must:
- Fix routing, missing pages, and navigation issues.
- Verify all main flows.
- Keep existing business logic (auth, plans, limits, admin, billing) intact.
- Avoid heavy refactors or renames that could break deployments or docs.

---

üß© PART 0 ‚Äî HIGH-LEVEL APP OVERVIEW (WHAT SHOULD EXIST)

Before changing anything, scan the code to understand what is already implemented.  
The app should already contain:

FUNCTIONALITY
- Auth:
  - Login / Register
  - JWT (httpOnly cookie)
  - `/auth/me` to get current user (including `role` and plan).
- Plans & Usage:
  - FREE plan with daily AI generation limit (FREE_DAILY_LIMIT).
  - PRO plan(s) (e.g. PRO_MONTHLY, PRO_YEARLY) with unlimited usage.
  - Middleware that enforces daily limits on AI endpoints for FREE users.
- Features:
  - Dashboard
  - AI Writer
  - Songwriter
  - Documents
  - File Uploads
  - Templates
  - Style Profiles
  - Search
  - Topics
  - Archive
  - Settings (account, plan, usage, logout)
- Admin:
  - Admin-only API: `/api/admin/*`
  - Admin page `/admin` with:
    - Users table (email, role, plan, usage)
    - Change user plan
    - Reset usage
    - Basic stats
  - Admin access controlled by `role === "admin"` (and/or ADMIN_EMAIL).
- Billing / Stripe:
  - `/api/billing/create-checkout-session`
  - Webhook or confirmation endpoint to upgrade plan on successful payment
  - UI upgrade buttons (Settings + Plans page)
  - Graceful state when Stripe is NOT configured:
    - ‚ÄúStripe payment processing is not currently configured. Please contact the administrator.‚Äù
- Legal & Branding:
  - Company metadata for **MH Trading GmbH** and Crew Art:
    - COMPANY_NAME, COMPANY_ADDRESS_LINE1/2, COMPANY_REG_ID, COMPANY_VAT_ID, COMPANY_PHONE, COMPANY_EMAIL, COMPANY_IBAN, COMPANY_BIC, COMPANY_BRAND_LINE.
  - Global footer with:
    - ‚ÄúDeveloped by Crew Art ¬∑ Powered by MH Trading GmbH‚Äù
    - Copyright line ¬© 2025 MH Trading GmbH. All rights reserved.
    - Product links: Dashboard, Pricing, Settings.
    - Legal links: Imprint, Privacy Policy, Terms of Use, Payment Policy.
  - Legal pages/routes:
    - `/legal/imprint`
    - `/legal/privacy`
    - `/legal/terms`
    - `/legal/payment`
- Templates:
  - MH Trading document template(s) with header/footer using company info.
- Health & Deployment:
  - `/healthz` endpoint.
  - `DEPLOYMENT.md` with env vars, Stripe & Admin sections.

You must **align the actual code** with this intended design and fix any gaps or mismatches.

---

üß© PART 1 ‚Äî FIX ROUTING & 404 ISSUES

1. Open the main routing setup on the client:
   - `client/src/App.tsx`
   - Any router config files (e.g. `client/src/router.tsx` or similar).
   - The main layout component that renders the sidebar + main content + footer.

2. Identify:
   - All <Route> definitions.
   - Which component is used as the 404 / NotFound page.
   - How the default route (`/`) is handled.

3. Fix routing so that the following paths are defined and render the correct page components (no 404):

   - `/dashboard`        ‚Üí Dashboard page
   - `/ai-writer`        ‚Üí AI Writer page
   - `/songwriter`       ‚Üí Songwriter page
   - `/documents`        ‚Üí Documents page
   - `/file-uploads`     ‚Üí File Uploads page
   - `/templates`        ‚Üí Templates page
   - `/style-profiles`   ‚Üí Style Profiles page
   - `/search`           ‚Üí Search page
   - `/topics`           ‚Üí Topics page
   - `/archive`          ‚Üí Archive page
   - `/settings`         ‚Üí Settings / Account page
   - `/admin`            ‚Üí Admin page (protected on backend by admin middleware)
   - `/legal/imprint`    ‚Üí Imprint / Legal Notice page
   - `/legal/privacy`    ‚Üí Privacy Policy
   - `/legal/terms`      ‚Üí Terms of Use
   - `/legal/payment`    ‚Üí Payment / Refund Policy
   - `/upgrade/success`  ‚Üí Upgrade success/confirmation page (if already implemented)

4. Ensure:
   - These routes are nested under a main layout so the sidebar + footer appear consistently.
   - The 404 route (NotFound) only catches unmatched routes (e.g. path="*") and does NOT override valid ones.
   - The root route `/` redirects to `/dashboard` (or another main page) **after auth**.

5. DO NOT:
   - Change the placement of QueryClientProvider (it must remain only at the top-level where it currently works).
   - Remove or rename working pages.

---

üß© PART 2 ‚Äî SIDEBAR & FOOTER LINKS CONSISTENCY

1. Open `client/src/components/AppSidebar.tsx` and make sure each menu item‚Äôs `to` path exactly matches the route names from Part 1:

   - Dashboard       ‚Üí `/dashboard`
   - AI Writer       ‚Üí `/ai-writer`
   - Songwriter      ‚Üí `/songwriter`
   - Documents       ‚Üí `/documents`
   - File Uploads    ‚Üí `/file-uploads`
   - Templates       ‚Üí `/templates`
   - Style Profiles  ‚Üí `/style-profiles`
   - Search          ‚Üí `/search`
   - Topics          ‚Üí `/topics`
   - Archive         ‚Üí `/archive`
   - Settings        ‚Üí `/settings`
   - Admin (only visible when user.role === "admin") ‚Üí `/admin`

2. Footer:

   - Ensure links map to:
     - Imprint       ‚Üí `/legal/imprint`
     - Privacy Policy‚Üí `/legal/privacy`
     - Terms of Use  ‚Üí `/legal/terms`
     - Payment Policy‚Üí `/legal/payment`

3. Fix any mismatches or typos so that every visible link leads to a valid registered route.

---

üß© PART 3 ‚Äî VERIFY & STABILIZE CORE FLOWS (WITHOUT REWRITING)

Now do a **lightweight but thorough correctness pass** across the main flows.  
The goal is to **fix bugs**, not to over-engineer.

For each area below:

- Only make changes that are necessary to fix clear issues.
- Keep API contracts and env var names the same.
- Avoid large refactors or renames.

1) Auth & Session

- Confirm:
  - Login works for:
    - FREE user: `test@example.com / Test1234`.
    - PRO/admin user: `mhtrading@gmail.com / test@123`.
  - `/auth/me` returns up-to-date user info including:
    - id, email, role, plan, usage counters.
- Ensure:
  - Unauthorized users cannot see workspace pages.
  - Admin-only endpoints require role = "admin".

2) Plans & Daily Limits

- Check the middleware and database fields for usage:
  - FREE users are rate-limited by FREE_DAILY_LIMIT.
  - PRO users are not limited.
- Do NOT change env var names (FREE_DAILY_LIMIT, SEED_* etc.).
- Fix only clear bugs (e.g., counters not reset or misread) if you find them.

3) Billing & Upgrade

- Confirm billing routes exist, e.g. `server/billingRoutes.ts`:

  - `POST /api/billing/create-checkout-session`:
    - If Stripe not configured ‚Üí returns 503 with a clear `"STRIPE_NOT_CONFIGURED"` message.
    - If configured ‚Üí returns `session.url`.

  - Webhook or confirmation endpoint (if implemented) upgrades user plan on success.

- In `Settings` and `Plans` pages:
  - Upgrade button:
    - When Stripe is NOT configured:
      - Show a friendly amber banner, **no crash**.
    - When Stripe is configured (for future real deployment):
      - Should redirect to Stripe Checkout.

- Do NOT fundamentally change this logic, only fix obvious bugs or inconsistent error handling.

4) Admin Panel

- Ensure:
  - Admin sidebar link only shows for `role === "admin"`.
  - `/admin` route renders the Admin page.
  - Admin API endpoints `/api/admin/*` are protected by admin middleware.
  - Admin can:
    - View users and their plans/usage.
    - Change user plan via API.
    - Reset usage (if implemented).
    - View basic stats.

- Fix any 404, import errors, or obvious rendering bugs.

5) Legal & Branding

- Confirm:
  - Global footer renders correctly on all main pages.
  - Legal pages (Imprint, Terms, Privacy, Payment Policy) load without 404 and show placeholder/legal text using company metadata.
  - Company metadata (MH Trading GmbH + Crew Art) is consistent across:
    - Footer
    - Imprint page
    - Templates (document preview footer)

- If some company info is still hard-coded with old placeholders (like contact@example.com), replace with the correct COMPANY_* values already provided in config.

---

üß© PART 4 ‚Äî DO NOT BREAK DEPLOYMENT OR CONFIG

While making changes, DO NOT:

- Rename env vars:
  - FREE_DAILY_LIMIT, ADMIN_EMAIL, STRIPE_* etc.
- Change DB schema in a breaking way.
- Remove or rename public API endpoints described in DEPLOYMENT.md.
- Move QueryClientProvider or change fundamental React Query setup.

If you need new config, add it in a backwards-compatible way.

---

üß© PART 5 ‚Äî BUILD & HEALTH VERIFICATION

After all fixes:

1) Run:

   ```bash
   npm run build
